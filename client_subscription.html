<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.2 from src\site\apt/client_subscription.apt.vm at 2021-02-27

 | Rendered using Apache Maven Default Skin
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.9.2" />
    <title>GraphQL Java Generator - Maven Plugin &#x2013; Subscription in client mode</title>
    <link rel="stylesheet" href="./css/maven-base.css" />
    <link rel="stylesheet" href="./css/maven-theme.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
  </head>
  <body class="composite">
    <div id="banner">
<div id="bannerLeft">com.graphql-java-generator:graphql-maven-plugin-project
</div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
      <div class="xleft">
        <span id="projectVersion">Version: 1.12.3</span>
      </div>
      <div class="xright"><a href="project.html" title="Project on Github">Project on Github</a>        &#xA0;| <span id="publishDate">Last Published: 2021-02-27</span>
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
       <h5>Plugin Usage</h5>
    <ul>
     <li class="none"><a href="README.html" title="Introduction">Introduction</a></li>
     <li class="none"><a href="change_log.html" title="Change Log">Change Log</a></li>
     <li class="none"><a href="customscalars.html" title="Custom Scalars">Custom Scalars</a></li>
     <li class="none"><a href="customtemplates.html" title="Custom Code Templates">Custom Code Templates</a></li>
     <li class="none"><a href="faq_client_and_server.html" title="FAQ (for both client and server mode)">FAQ (for both client and server mode)</a></li>
    </ul>
       <h5>Client mode</h5>
    <ul>
     <li class="none"><a href="client_spring.html" title="Creating a first app (spring)">Creating a first app (spring)</a></li>
     <li class="none"><a href="client_non_spring.html" title="Creating a first app (non spring)">Creating a first app (non spring)</a></li>
     <li class="none"><a href="exec_graphql_requests.html" title="Execute GraphQL requests">Execute GraphQL requests</a></li>
     <li class="none"><a href="client_tutorial.html" title="Client Tutorial">Client Tutorial</a></li>
     <li class="none"><strong>Subscription</strong></li>
     <li class="none"><a href="introspection.html" title="Introspection">Introspection</a></li>
     <li class="none"><a href="client_add_relay_connection.html" title="Relay Connections">Relay Connections</a></li>
     <li class="none"><a href="runtimeclasses.html" title="Runtime Classes">Runtime Classes</a></li>
     <li class="none"><a href="client_oauth2.html" title="Access to an OAuth2 GraphQL server">Access to an OAuth2 GraphQL server</a></li>
     <li class="none"><a href="client_personalization.html" title="How to personalize the client app">How to personalize the client app</a></li>
     <li class="none"><a href="faq_client.html" title="FAQ (client mode)">FAQ (client mode)</a></li>
    </ul>
       <h5>Server mode</h5>
    <ul>
     <li class="none"><a href="server.html" title="Server usage">Server usage</a></li>
     <li class="none"><a href="server_tutorial.html" title="Server Tutorial">Server Tutorial</a></li>
     <li class="none"><a href="server_subscription.html" title="Subscription">Subscription</a></li>
     <li class="none"><a href="server_add_relay_connection.html" title="Relay Connections">Relay Connections</a></li>
     <li class="none"><a href="server_oauth2.html" title="Implement an OAuth2 GraphQL server">Implement an OAuth2 GraphQL server</a></li>
     <li class="none"><a href="schema_personalization.html" title="Howto personalize the generated code">Howto personalize the generated code</a></li>
    </ul>
       <h5>Project internal</h5>
    <ul>
     <li class="none"><a href="howto_build.html" title="How to build?">How to build?</a></li>
     <li class="none"><a href="howto_contribute.html" title="How to contribute?">How to contribute?</a></li>
     <li class="none"><a href="howto_pgp_key.html" title="How to create a PGP key?">How to create a PGP key?</a></li>
     <li class="none"><a href="howto_release.html" title="How to release?">How to release?</a></li>
    </ul>
       <h5>Modules</h5>
    <ul>
     <li class="none"><a href="graphql-java-runtime/index.html" title="graphql-java-runtime">graphql-java-runtime</a></li>
     <li class="none"><a href="graphql-maven-plugin/index.html" title="graphql-maven-plugin">graphql-maven-plugin</a></li>
     <li class="none"><a href="graphql-java-client-dependencies/index.html" title="graphql-java-client-dependencies">graphql-java-client-dependencies</a></li>
     <li class="none"><a href="graphql-java-server-dependencies/index.html" title="graphql-java-server-dependencies">graphql-java-server-dependencies</a></li>
     <li class="none"><a href="graphql-maven-plugin-logic/index.html" title="graphql-maven-plugin-logic">graphql-maven-plugin-logic</a></li>
     <li class="none"><a href="graphql-maven-plugin-samples/index.html" title="graphql-maven-plugin-samples">graphql-maven-plugin-samples</a></li>
    </ul>
       <h5>Project Documentation</h5>
    <ul>
     <li class="collapsed"><a href="project-info.html" title="Project Information">Project Information</a></li>
    </ul>
      <a href="https://maven.apache.org/" title="Maven" class="poweredBy">
        <img class="poweredBy"  alt="Maven" src="https://maven.apache.org/images/logos/maven-feather.png"     />
      </a>
      </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
<section>
<h2><a name="Subscription_in_client_mode"></a>Subscription in client mode</h2>
<ul>
<li><a href="#Subscription_in_client_mode">Subscription in client mode</a>
<ul>
<li><a href="#Summary">Summary</a></li>
<li><a href="#How_to_use_subscriptions_with_the_plugin.3F">How to use subscriptions with the plugin?</a>
<ul>
<li><a href="#Partial_requests">Partial requests</a></li></ul></li>
<li><a href="#Use_direct_queries">Use direct queries</a></li></ul></li></ul><section>
<h3><a name="Summary">Summary</a></h3>
<p>The client mode makes it easy for a Java GraphQL client-side application, to execute subscriptions against a GraphQL server. The graphql-maven-plugin generates all the necessary code, so that a Java application can call a GraphQL server by simply calling the relevant Java method.</p>
<p>The subscription works only with <b>Partial Request</b> , as a Callback class must be given for each Subscription. You'll find the difference between Full and Partial requests on the <a href="./client.html">client page</a>.</p>
<p>As for queries and mutations, subscription can be executed in two ways:</p>
<ul>
<li>The <b>direct execution</b>: you call the generated method with the GraphQL request (partial or full), and you receive the result into Java objects. This is simpler, but slower: for technical reasons, the plugin has two analyze the content of the request. 
<ul>
<li>As Subscription is usually executed once, the direct execution is the recommended way to execute subscriptions.</li></ul></li>
<li>The <b>prepared execution</b>: 
<ul>
<li>A GraphQLRequest object is created by the application, if possible at application startup. This allows to analyze the request only once. And it avoids errors during the app execution, as all the GraphQL requests have been checked at startup.</li>
<li>Each GraphQL request execution is executed from this object. </li></ul></li></ul>
<p>Both kinds of requests, and both modes of execution allows to use bind parameters into your query definitions. </p></section><section>
<h3><a name="How_to_use_subscriptions_with_the_plugin.3F"></a><a name="How_to_use_subscriptions_with_the_plugin">How to use subscriptions with the plugin?</a></h3>
<p>First, you'll have to create or get your GraphQL schema. The GraphQL plugin expects a <i>.graphqls</i> file. See the <a class="externalLink" href="https://graphql.org/learn/schema/">GraphQL schema doc</a> for all the details.</p>
<p>Then, add the plugin to your Maven POM file, as described in the <a href="./client.html">client page</a>.</p><section>
<h4><a name="Partial_requests">Partial requests</a></h4>
<p>Full request don't allow Subscription execution. So only Partial requests are described here.</p>
<p>In each query/mutation/subscription class, the plugin also generates <i>Xxxx</i> and <i>XxxxWithBindValues</i> methods, where <i>Xxxx</i> is successively each query/mutation/subscription defined in this query/mutation/subscription object.</p>
<p>In these methods:</p>
<ul>
<li>The query/mutation/subscription parameters (as defined in the GraphQL schema) become parameters of the relevant generated java methods. So you don't need to define and map bind parameters for them.
<ul>
<li>But you can still use bind parameters for input parameters of the fields you request, of course</li></ul></li>
<li>The subscription methods return an instance of <a class="externalLink" href="https://graphql-maven-plugin-project.graphql-java-generator.com/graphql-java-runtime/apidocs/com/graphql_java_generator/client/SubscriptionClient.html">SubscriptionClient</a>. 
<ul>
<li>This interface has only one method: <i>I</i>unsubscribe()<i>/I</i>, which allows to unsubscribe from this subscribed subscription. This frees resources on both the client and the server, and the network of course. </li></ul></li></ul>
<p>Below is a sample of the client code:</p>
<div class="source">
<pre>SubscriptionTypeExecutor subscriptionExecutor;
GraphQLRequest subscriptionRequest;
SubscriptionClient client;

void setup() {
                // Instantiate a Subscription executor, with the relevant GraphQL endpoint.
                // The classname of the Subscription is the type name, as defined in the GraphQL schema 
                subscriptionExecutor = new SubscriptionTypeExecutor(&quot;http://localhost:8180/graphql/subscription&quot;);
                                
                // Create the GraphQL request
                // The expected notifications are Post, with these fields: {id date author publiclyAvailable title content}
                // As author is an object without fields defined, all its fields will be returned
                subscriptionRequest = subscriptionExecutor
                                .getSubscribeToNewPostGraphQLRequest(&quot;{id date author publiclyAvailable title content}&quot;);
}

void subscribe() {
        // We create the callback that'll receive the notifications. 
        // It must be an instance of SubscriptionCallback&lt;Post&gt;, as this subscription returns a Post 
        PostSubscriptionCallback&lt;Post&gt; postSubscriptionCallback = new PostSubscriptionCallback&lt;&gt;();
        
        // The subscription request accepts one parameter. If you don't want to provide it, you can give it the null value
        client = subscriptionExecutor.subscribeToNewPost(subscriptionRequest, postSubscriptionCallback, &quot;Board name 1&quot;);

}
</pre></div>
<p>Please note the particular URL, here: there seems to be a limitation in the Java implementation for Web Sockets. This impacts GraphQL subscription, as they are implemented by a Web Socket. This java limitation, is that it seems not possible to have both standard HTTP request (GET, POST) and Web Socket request on the same URL.</p>
<p>So if your GraphQL server is a Java one, you need a specific path for the subscription.</p>
<p>If you're using another GraphQL server implementation, then you should be able to have the same URL for queries, mutations and subscriptions, as expected by the GraphQL specification.</p>
<p>The subscription specific part is the <b>creation of the callback</b>. The code for the <i>PostSubscriptionCallback</i> class used in the above sample is <a class="externalLink" href="https://github.com/graphql-java-generator/graphql-maven-plugin-project/blob/master/graphql-maven-plugin-samples/graphql-maven-plugin-samples-Forum-client/src/test/java/com/graphql_java_generator/samples/forum/client/subscription/PostSubscriptionCallback.java">available on github</a>.</p>
<p>Of course, you can use bind variables, as with queries and mutations.</p></section></section><section>
<h3><a name="Use_direct_queries">Use direct queries</a></h3>
<p>If you don't want to store the <i>GraphQLRequest</i>, you can avoid that, by using direct queries. The overhead that exists at each execution is not an issue here, as you'll probably execute the subscription only once.</p>
<p>You still need to provide the callback, that'll receive the notifications you've subscribed to.</p>
<p>Here is a sample with the bind parameters value given as method parameters: </p>
<div class="source">
<pre>SubscriptionTypeExecutor subscriptionExecutor;
SubscriptionClient client;

void setup() {
                // Instantiate a Subscription executor, with the relevant GraphQL endpoint.
                // The classname of the Subscription is the type name (as defined in the GraphQL schema) suffixed by Executor
                subscriptionExecutor = new SubscriptionTypeExecutor(&quot;http://localhost:8180/graphql/subscription&quot;);
}

void subscribe() {
        // We create the callback that'll receive the notifications. 
        // It must be an instance of SubscriptionCallback&lt;Post&gt;, as this subscription returns a Post 
        PostSubscriptionCallback&lt;Post&gt; postSubscriptionCallback = new PostSubscriptionCallback&lt;&gt;();
        
        // The subscription request accepts one parameter. If you don't want to provide it, you can give it the null value
        client = subscriptionExecutor.subscribeToNewPost(&quot;{id date author publiclyAvailable title content}&quot;, postSubscriptionCallback, &quot;Board name 1&quot;);

}
</pre></div></section></section>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
        Copyright &#169;      2021..      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
