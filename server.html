<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.2 from src\site\markdown/server.md.vm at 2021-02-27

 | Rendered using Apache Maven Default Skin
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.9.2" />
    <title>GraphQL Java Generator - Maven Plugin &#x2013; GraphQL Maven Plugin (server mode)</title>
    <link rel="stylesheet" href="./css/maven-base.css" />
    <link rel="stylesheet" href="./css/maven-theme.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
  </head>
  <body class="composite">
    <div id="banner">
<div id="bannerLeft">com.graphql-java-generator:graphql-maven-plugin-project
</div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
      <div class="xleft">
        <span id="projectVersion">Version: 1.12.3</span>
      </div>
      <div class="xright"><a href="project.html" title="Project on Github">Project on Github</a>        &#xA0;| <span id="publishDate">Last Published: 2021-02-27</span>
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
       <h5>Plugin Usage</h5>
    <ul>
     <li class="none"><a href="README.html" title="Introduction">Introduction</a></li>
     <li class="none"><a href="change_log.html" title="Change Log">Change Log</a></li>
     <li class="none"><a href="customscalars.html" title="Custom Scalars">Custom Scalars</a></li>
     <li class="none"><a href="customtemplates.html" title="Custom Code Templates">Custom Code Templates</a></li>
     <li class="none"><a href="faq_client_and_server.html" title="FAQ (for both client and server mode)">FAQ (for both client and server mode)</a></li>
    </ul>
       <h5>Client mode</h5>
    <ul>
     <li class="none"><a href="client_spring.html" title="Creating a first app (spring)">Creating a first app (spring)</a></li>
     <li class="none"><a href="client_non_spring.html" title="Creating a first app (non spring)">Creating a first app (non spring)</a></li>
     <li class="none"><a href="exec_graphql_requests.html" title="Execute GraphQL requests">Execute GraphQL requests</a></li>
     <li class="none"><a href="client_tutorial.html" title="Client Tutorial">Client Tutorial</a></li>
     <li class="none"><a href="client_subscription.html" title="Subscription">Subscription</a></li>
     <li class="none"><a href="introspection.html" title="Introspection">Introspection</a></li>
     <li class="none"><a href="client_add_relay_connection.html" title="Relay Connections">Relay Connections</a></li>
     <li class="none"><a href="runtimeclasses.html" title="Runtime Classes">Runtime Classes</a></li>
     <li class="none"><a href="client_oauth2.html" title="Access to an OAuth2 GraphQL server">Access to an OAuth2 GraphQL server</a></li>
     <li class="none"><a href="client_personalization.html" title="How to personalize the client app">How to personalize the client app</a></li>
     <li class="none"><a href="faq_client.html" title="FAQ (client mode)">FAQ (client mode)</a></li>
    </ul>
       <h5>Server mode</h5>
    <ul>
     <li class="none"><strong>Server usage</strong></li>
     <li class="none"><a href="server_tutorial.html" title="Server Tutorial">Server Tutorial</a></li>
     <li class="none"><a href="server_subscription.html" title="Subscription">Subscription</a></li>
     <li class="none"><a href="server_add_relay_connection.html" title="Relay Connections">Relay Connections</a></li>
     <li class="none"><a href="server_oauth2.html" title="Implement an OAuth2 GraphQL server">Implement an OAuth2 GraphQL server</a></li>
     <li class="none"><a href="schema_personalization.html" title="Howto personalize the generated code">Howto personalize the generated code</a></li>
    </ul>
       <h5>Project internal</h5>
    <ul>
     <li class="none"><a href="howto_build.html" title="How to build?">How to build?</a></li>
     <li class="none"><a href="howto_contribute.html" title="How to contribute?">How to contribute?</a></li>
     <li class="none"><a href="howto_pgp_key.html" title="How to create a PGP key?">How to create a PGP key?</a></li>
     <li class="none"><a href="howto_release.html" title="How to release?">How to release?</a></li>
    </ul>
       <h5>Modules</h5>
    <ul>
     <li class="none"><a href="graphql-java-runtime/index.html" title="graphql-java-runtime">graphql-java-runtime</a></li>
     <li class="none"><a href="graphql-maven-plugin/index.html" title="graphql-maven-plugin">graphql-maven-plugin</a></li>
     <li class="none"><a href="graphql-java-client-dependencies/index.html" title="graphql-java-client-dependencies">graphql-java-client-dependencies</a></li>
     <li class="none"><a href="graphql-java-server-dependencies/index.html" title="graphql-java-server-dependencies">graphql-java-server-dependencies</a></li>
     <li class="none"><a href="graphql-maven-plugin-logic/index.html" title="graphql-maven-plugin-logic">graphql-maven-plugin-logic</a></li>
     <li class="none"><a href="graphql-maven-plugin-samples/index.html" title="graphql-maven-plugin-samples">graphql-maven-plugin-samples</a></li>
    </ul>
       <h5>Project Documentation</h5>
    <ul>
     <li class="collapsed"><a href="project-info.html" title="Project Information">Project Information</a></li>
    </ul>
      <a href="https://maven.apache.org/" title="Maven" class="poweredBy">
        <img class="poweredBy"  alt="Maven" src="https://maven.apache.org/images/logos/maven-feather.png"     />
      </a>
      </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
<h1>GraphQL Maven Plugin (server mode)</h1>
<p>This project is a maven plugin, which makes it easy to work in Java with graphQL in a schema first approach.</p>
<p>In server mode, the graphql-maven-plugin reads a <b>graphqls schema</b>, and generated the maximum of boilerplate code. That is, it generates:</p>
<ul>

<li>When in a jar maven project, the main class to start a Spring Boot application</li>
<li>When in a war maven project, the servlet configuration to be embedded in a war package. It can then be deployed in any standard application server</li>
<li>Almost all the Spring components to wire the whole stuff</li>
<li>The interfaces (DataFetchersDelegate) for the classes that are specific to the application context (see below)</li>
<li>The POJOs to manipulate the GraphQL objects defined in the GraphQL schema.
<ul>

<li>These POJOs are annotated with JPA annotations. This allows to link them to almost any database</li>
<li>You can customize these annotations, with the Schema Personalization file (see below for details)</li>
<li>(in a near future) It will be possible to define your own code template, to generate exactly the code you want</li>
</ul>
</li>
</ul>
<p>Please note that the generated code uses dataloader to greatly improve the server&#x2019;s performances. See <a class="externalLink" href="https://github.com/graphql-java/java-dataloader">https://github.com/graphql-java/java-dataloader</a>.</p>
<p>Once all this is generated, you&#x2019;ll have to implement the DataFetchersDelegate interfaces. The DataFetchersDelegate implementation is the only work that remains on your side. They are the link between the GraphQL schema and your data storage. See below for more details.</p>
<p>Depending on your use case, you can set the maven packaging to jar or war, in your pom. This changes the generated code. But your specific code is exactly the same. That is: <b>you can change the packaging at any time</b>, and it will still produce a ready-to-go product without any other modification from you.</p>
<p>Below you&#x2019;ll find:</p>
<ul>

<li>A sample pom to start with</li>
<li>The explanation about the DataFetchersDelegate interfaces you&#x2019;ll have to implement.</li>
</ul>
<p>The parameters for the server are stored in the <i>application.properties</i> file.</p>
<p>You can have a look at this file, in the given server samples. It&#x2019;s a standard spring boot configuration file, so you&#x2019;ll find all the needed information on the net.</p>
<p>If you want to expose your Spring Boot app in <b>https</b>, take a look at the doc on the net. All parameters will go in the <i>application.properties</i>. For instance, <a class="externalLink" href="https://www.thomasvitale.com/https-spring-boot-ssl-certificate/">Thomas Vitale</a> provides a doc for that.</p>
<p>The important parameter is: <b>server.port</b> (for instance &lt;server.port = 8180&gt;), which determines the app port, when running as a spring boot app, that is, when it&#x2019;s packaged as a jar.</p>
<p>The <b>path</b> depends on the way the GraphQL is run:</p>
<ul>

<li>

<p>If packaged as a jar: the path is /graphql</p>
</li>
<li>

<p>If packaged as a war: the paths is /{WebAppContext}/graphql</p>
</li>
</ul>
<p>Create a new Maven Project, with this pom, for instance :</p>

<div class="source">
<div class="source">
<pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
	xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

	&lt;parent&gt;
		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
		&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
		&lt;version&gt;2.1.3.RELEASE&lt;/version&gt;
	&lt;/parent&gt;

	&lt;groupId&gt;com.graphql-java&lt;/groupId&gt;
	&lt;artifactId&gt;mytest-of-graphql-maven-plugin&lt;/artifactId&gt;
	&lt;version&gt;0.1.0-SNAPSHOT&lt;/version&gt;

	&lt;build&gt;
		&lt;plugins&gt;
			&lt;plugin&gt;
				&lt;groupId&gt;com.graphql-java&lt;/groupId&gt;
				&lt;artifactId&gt;graphql-maven-plugin&lt;/artifactId&gt;
				&lt;version&gt;1.12.3&lt;/version&gt;
				&lt;executions&gt;
					&lt;execution&gt;
						&lt;goals&gt;
							&lt;goal&gt;graphql&lt;/goal&gt;
						&lt;/goals&gt;
					&lt;/execution&gt;
				&lt;/executions&gt;
				&lt;configuration&gt;
					&lt;packageName&gt;org.my.package&lt;/packageName&gt;
					&lt;mode&gt;server&lt;/mode&gt;
				&lt;/configuration&gt;
			&lt;/plugin&gt;
			&lt;plugin&gt;
				&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
				&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
				&lt;executions&gt;
					&lt;execution&gt;
						&lt;goals&gt;
							&lt;goal&gt;repackage&lt;/goal&gt;
						&lt;/goals&gt;
					&lt;/execution&gt;
				&lt;/executions&gt;
			&lt;/plugin&gt;
		&lt;/plugins&gt;
		&lt;extensions&gt;
			&lt;!-- Adding these extensions prevents the error below, with JDK 9 and higher: --&gt;
			&lt;!-- NoSuchMethodError: 'java.lang.String javax.annotation.Resource.lookup()' --&gt;
			&lt;extension&gt;
				&lt;groupId&gt;javax.annotation&lt;/groupId&gt;
				&lt;artifactId&gt;javax.annotation-api&lt;/artifactId&gt;
				&lt;version&gt;1.3.2&lt;/version&gt;
			&lt;/extension&gt;
			&lt;extension&gt;
				&lt;groupId&gt;javax.annotation&lt;/groupId&gt;
				&lt;artifactId&gt;jsr250-api&lt;/artifactId&gt;
				&lt;version&gt;1.0&lt;/version&gt;
			&lt;/extension&gt;
		&lt;/extensions&gt;
	&lt;/build&gt;

	&lt;dependencies&gt;
		&lt;!-- Dependencies for tests --&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework&lt;/groupId&gt;
			&lt;artifactId&gt;spring-test&lt;/artifactId&gt;
			&lt;scope&gt;test&lt;/scope&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;
			&lt;artifactId&gt;junit-jupiter-api&lt;/artifactId&gt;
			&lt;scope&gt;test&lt;/scope&gt;
		&lt;/dependency&gt;

		&lt;!-- Dependencies for GraphQL --&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;com.graphql-java-kickstart&lt;/groupId&gt;
			&lt;artifactId&gt;graphql-spring-boot-starter&lt;/artifactId&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;com.graphql-java-kickstart&lt;/groupId&gt;
			&lt;artifactId&gt;graphql-java-tools&lt;/artifactId&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;!-- gives a GUI to test the GraphQL request on the generated server: http://localhost:8080/graphiql --&gt;
			&lt;groupId&gt;com.graphql-java-kickstart&lt;/groupId&gt;
			&lt;artifactId&gt;graphiql-spring-boot-starter&lt;/artifactId&gt;
			&lt;scope&gt;runtime&lt;/scope&gt;
		&lt;/dependency&gt;

		&lt;!-- Other dependencies --&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;com.h2database&lt;/groupId&gt;
			&lt;artifactId&gt;h2&lt;/artifactId&gt;
			&lt;scope&gt;runtime&lt;/scope&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.dbunit&lt;/groupId&gt;
			&lt;artifactId&gt;dbunit&lt;/artifactId&gt;
		&lt;/dependency&gt;
	&lt;/dependencies&gt;
&lt;/project&gt;
</pre></div></div>

<p>Take care of the two parameters of the Maven Plugin that have been set there:</p>
<ul>

<li>mode: as client is the default mode, you must define the mode as server, here, to generate the server code.</li>
<li><b>packageName</b>: Very important. This package is where the main code is defined. The Spring container is started from this package. The implementations of the DataFetchersDelegate (see below) will be searched in this package, and in its subpackages. So this package must be a package that is the same, or that contains the packages where you define your implementations of DataFetchersDelegate</li>
</ul>
<p>Then do a first build :</p>

<div class="source">
<div class="source">
<pre>mvn clean install
</pre></div></div>

<p>The build will complain about the DataFetchersDelegate you need to define.</p>
<p><b>The short story is this one</b>:</p>
<ul>

<li>The code generated by the GraphQL maven plugin directly maps to the entity, thanks to <a class="externalLink" href="https://spring.io/projects/spring-data-jpa">Spring Data JPA</a>&#x2019;s magic.</li>
<li>You still needs to implement the DataFetchersDelegate interfaces, to manage the access to your data modele (see the samples and below, to see how to do this).</li>
</ul>
<p><b>A longer story is this one</b>:</p>
<p>The generated code can not be automatically adapted to all and every data model that exists, and even less all combinations between local and distant data that you may have on server side. So the generated code is only the basis for what&#x2019;s most common to all implementations.</p>
<p>Then, it&#x2019;s up to you to map the generated POJOs to your own data model.</p>
<p>In usual cases, this mapping is actually declaring the <a class="externalLink" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.repositories">Spring Data Repositories</a>, and call them from your implementation of the calling the DataFetchersDelegate interfaces, that have been generated by the graphql-java-generator plugin.</p>
<p>==&gt; You can see such an example in the <a class="externalLink" href="https://github.com/graphql-java-generator/graphql-maven-plugin-project/tree/master/graphql-maven-plugin-samples/graphql-maven-plugin-samples-Forum-server">forum server sample</a>. This sample is embedded into the plugin project, and is used as an integration test.</p>
<p>If the GraphQL schema is really different from the data model, then you may have to implement the relevant logic to fit your data model into the GraphQL model.</p>
<p>==&gt; You can see such an example in the <a class="externalLink" href="https://github.com/graphql-java-generator/graphql-maven-plugin-project/tree/master/graphql-maven-plugin-samples/graphql-maven-plugin-samples-StarWars-server">StarWars server sample</a>. This sample is embedded into the plugin project, and is used as an integration test.</p>
<p><b>Write your implementation for the DataFetchersDelegate</b>:</p>
<p>Basically, the plugin generates one DataFetchersDelegate interfaces for each object in the GraphQL schema, whether they are regular objects or query/mutation/subscription objects.</p>
<p>These DataFetchersDelegate interfaces contains one method for each Data Fetcher that must be implemented, and a <i>batchLoader</i> method used by the DataLoader:</p>
<ul>

<li>For regular objects, there is one method par attribute that is another object or a list. This method will be called each time the GraphQL engine needs to read such an attribute, that is, each time it needs to go across a relationship from one object to a linked one. This method will have these parameters:
<ul>

<li><a class="externalLink" href="https://github.com/graphql-java/graphql-java/blob/master/src/main/java/graphql/schema/DataFetchingEnvironment.java">DataFetchingEnvironment</a>: This is the GraphQL context. It can be used to retrieve data about the request.</li>
<li>(Optional) <b>DataLoader</b>: the data loader that will retrieve the data, asynchronously, merging all loading into one database call. Big performance improvement!
<ul>

<li>Please note that the cache for the DataLoader is managed <b>per request</b>.</li>
</ul>
</li>
<li><b>Source Object</b>: The POJO that is the parent object from which this DataFetcher will fetch an attribute. Typically, you can get its id, to read the data from a join in a database. See the provided samples for more details.</li>
<li><b>Parameters</b>: The list of each parameters for the field to be fetched, as defined in the GraphQL schema. The parameter is null if not provided (only possible if this parameter is not mandatory)</li>
</ul>
</li>
<li>For query/mutation/subscription objects, there is one method for each attribute, as each attribute is actually a query, a mutation or a subscription.
<ul>

<li><a class="externalLink" href="https://github.com/graphql-java/graphql-java/blob/master/src/main/java/graphql/schema/DataFetchingEnvironment.java">DataFetchingEnvironment</a>: This is the GraphQL context. It can be used to retrieve data about the request.</li>
<li><b>Parameters</b>: The list of each parameters for this query/mutation/subscription, as defined in the GraphQL schema. The parameter is null if not provided (only possible if this parameter is not mandatory)</li>
</ul>
</li>
</ul>
<p>The methods implemented by a DataFetchersDelegate are the actual DataFetchers. They can return (also see the sample below):</p>
<ul>

<li>CompletableFuture&lt;Xxx&gt;: this is when the data can be retrieved asynchronously through a DataLoader. In this case, the DataLoader collects all the Id that must be read from the datastore. This id list is de-duplicated (an id will be loaded once), and all the remaining ids are loaded in unique call to the datastore, thanks to the DataLoader that calls the relevant <i>batchLoader</i> method.</li>
<li>Xxx (not a CompletableFuture): the request will be executed for each object, and must return the expected Xxx data.</li>
</ul>
<p>The DataFetchersDelegate implementation must be a Spring Bean (marked by the @Component spring framework annotation): Spring will magically discover them during the app or war startup: Spring is fantastic! :)</p>
<p>The only constraint you <b>must</b> respect is that these DataFetchersDelegate implementations are in the same package or a sub-package of the target package of the generated code. This package is:</p>
<ul>

<li>defined in the pom, in the <i>package</i> configuration item of the graphql-java-generator plugin,</li>
<li>or, if you have not defined it in the page, the default package name is <i>com.generated.graphql</i>.</li>
</ul>
<p>So your DataFetchersDelegate implementation class will look like the sample below. Rather simple, isn&#x2019;t it!</p>

<div class="source">
<div class="source">
<pre>package com.graphql_java_generator.samples.forum.server.specific_code;

import java.util.List;
import java.util.UUID;
import java.util.concurrent.CompletableFuture;

import javax.annotation.Resource;

import org.dataloader.DataLoader;
import org.springframework.stereotype.Component;

import com.graphql_java_generator.samples.forum.server.GraphQLUtil;
import com.graphql_java_generator.samples.forum.server.Member;
import com.graphql_java_generator.samples.forum.server.Post;
import com.graphql_java_generator.samples.forum.server.Topic;
import com.graphql_java_generator.samples.forum.server.TopicDataFetchersDelegate;
import com.graphql_java_generator.samples.forum.server.jpa.MemberRepository;
import com.graphql_java_generator.samples.forum.server.jpa.PostRepository;
import com.graphql_java_generator.samples.forum.server.jpa.TopicRepository;

import graphql.schema.DataFetchingEnvironment;

@Component
public class DataFetchersDelegateTopicImpl implements DataFetchersDelegateTopic {

	@Resource
	MemberRepository memberRepository;
	@Resource
	PostRepository postRepository;
	@Resource
	TopicRepository topicRepository;

	@Resource
	GraphQLUtil graphQLUtil;

	@Override
	public CompletableFuture&lt;Member&gt; author(DataFetchingEnvironment dataFetchingEnvironment,
			DataLoader&lt;UUID, Member&gt; dataLoader, Topic source) {
		return dataLoader.load(source.getAuthorId());
	}

	@Override
	public List&lt;Post&gt; posts(DataFetchingEnvironment dataFetchingEnvironment, Topic source, String since) {
		if (since == null)
			return graphQLUtil.iterableToList(postRepository.findByTopicId(source.getId()));
		else
			return graphQLUtil.iterableToList(postRepository.findByTopicIdAndSince(source.getId(), since));
	}

	@Override
	public List&lt;Topic&gt; batchLoader(List&lt;UUID&gt; keys) {
		return topicRepository.findByIds(keys);
	}
}
</pre></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
        Copyright &#169;      2021..      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
